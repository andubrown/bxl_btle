workflows:
  ios_build:
    name: iOS Debug Build
    environment:
      flutter: stable
      xcode: latest

    scripts:
      - name: Clean and regenerate iOS folder
        script: |
          flutter clean
          rm -rf ios
          flutter create .

      - name: Force Podfile to iOS 15.5
        script: |
          sed -i '' "s/platform :ios.*/platform :ios, '15.5'/" ios/Podfile

      - name: Force Xcode project to iOS 15.5
        script: |
          sed -i '' "s/IPHONEOS_DEPLOYMENT_TARGET = [0-9.]*/IPHONEOS_DEPLOYMENT_TARGET = 15.5/" ios/Runner.xcodeproj/project.pbxproj

      - name: Get Flutter dependencies
        script: flutter pub get

      - name: Install CocoaPods
        script: |
          cd ios
          pod install
          cd ..

      - name: Build iOS (debug, no codesign)
        script: flutter build ios --debug --no-codesign

    artifacts:
      - build/ios/iphoneos/*.app
